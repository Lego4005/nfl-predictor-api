# Redis Configuration for Testing
# Optimized for test environment with fast execution and memory efficiency

# Basic Configuration
port 6379
bind 0.0.0.0
protected-mode no
timeout 300
tcp-keepalive 60

# Memory Configuration
maxmemory 256mb
maxmemory-policy allkeys-lru
maxmemory-samples 5

# Persistence (Disabled for faster tests)
save ""
appendonly no
auto-aof-rewrite-percentage 0

# Logging
loglevel notice
syslog-enabled yes
syslog-ident "redis-test"

# Database Configuration
databases 16
dbfilename "test-dump.rdb"
dir "/data"

# Performance Tuning for Tests
tcp-backlog 128
hz 10
dynamic-hz yes

# Client Configuration
maxclients 1000

# Security (Relaxed for testing)
requirepass ""

# Keyspace Notifications (Enable for testing WebSocket functionality)
notify-keyspace-events "KEA"

# Module Configuration
loadmodule /usr/lib/redis/modules/redisearch.so
loadmodule /usr/lib/redis/modules/rejson.so

# Test-specific configuration
# Enable all commands for testing
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""

# Memory diagnostics
memory-usage-threshold 200mb

# Test data TTL defaults
# Game data expires in 1 hour
# Prediction data expires in 30 minutes
# Cache data expires in 10 minutes

# Lua scripting (enabled for complex test scenarios)
lua-time-limit 5000

# Slow log configuration for performance testing
slowlog-log-slower-than 1000
slowlog-max-len 128

# Client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Hash configuration for efficient small object storage
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# List configuration
list-max-ziplist-size -2
list-compress-depth 0

# Set configuration
set-max-intset-entries 512

# Sorted set configuration
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# Stream configuration
stream-node-max-bytes 4096
stream-node-max-entries 100