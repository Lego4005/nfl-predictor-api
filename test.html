<!DOCTYPE html>
<html>

<head>
    <title>NFL Predictor Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .tab {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            background: #f0f0f0;
            cursor: pointer;
        }

        .tab.active {
            background: #007cba;
            color: white;
        }

        .content {
            margin-top: 20px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .error {
            color: red;
            padding: 20px;
        }

        .top-three {
            background-color: #f0fdf4 !important;
        }

        .confidence-high {
            color: #22c55e;
            font-weight: bold;
        }

        .confidence-medium {
            color: #f59e0b;
            font-weight: bold;
        }

        .confidence-low {
            color: #6b7280;
        }

        .pick-over {
            color: #ef4444;
            font-weight: bold;
        }

        .pick-under {
            color: #3b82f6;
            font-weight: bold;
        }

        .spread-positive {
            color: #ef4444;
            font-weight: bold;
        }

        .spread-negative {
            color: #22c55e;
            font-weight: bold;
        }

        .team-logo {
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }

        .data-source-indicator {
            font-size: 12px;
            margin-left: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            background: #f3f4f6;
        }

        .live-data {
            background: #dcfce7;
            color: #166534;
        }

        .mock-data {
            background: #fef3c7;
            color: #92400e;
        }
    </style>
</head>

<body>
    <h1>NFL 2025 Predictions â€” Week <span id="week">1</span></h1>

    <div style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0;">
        <div>
            <label>Week:
                <select id="weekSelect" onchange="changeWeek()">
                    <option value="1">Week 1</option>
                    <option value="2">Week 2</option>
                    <option value="3">Week 3</option>
                    <option value="4">Week 4</option>
                    <option value="5">Week 5</option>
                    <option value="6">Week 6</option>
                    <option value="7">Week 7</option>
                    <option value="8">Week 8</option>
                    <option value="9">Week 9</option>
                    <option value="10">Week 10</option>
                    <option value="11">Week 11</option>
                    <option value="12">Week 12</option>
                    <option value="13">Week 13</option>
                    <option value="14">Week 14</option>
                    <option value="15">Week 15</option>
                    <option value="16">Week 16</option>
                    <option value="17">Week 17</option>
                    <option value="18">Week 18</option>
                </select>
            </label>
            <button onclick="fetchData()" style="margin-left: 10px;">ðŸ”„ Refresh</button>
            <span id="dataSourceIndicator" class="data-source-indicator"></span>
        </div>
        <div>
            <button onclick="downloadCSV()" style="margin-right: 5px;">ðŸ“Š CSV</button>
            <button onclick="downloadPDF()">ðŸ“„ PDF</button>
        </div>
    </div>

    <div style="margin: 20px 0;">
        <div class="tab active" onclick="showTab('su')">Straight-Up</div>
        <div class="tab" onclick="showTab('ats')">ATS</div>
        <div class="tab" onclick="showTab('totals')">Totals</div>
        <div class="tab" onclick="showTab('props')">Props</div>
        <div class="tab" onclick="showTab('fantasy')">Fantasy</div>
    </div>

    <div id="loading" class="loading" style="display: none;">Loading...</div>
    <div id="error" class="error" style="display: none;"></div>

    <div id="su-content" class="content">
        <h3 id="su-title">Straight-Up Picks</h3>
        <table id="su-table">
            <thead>
                <tr>
                    <th>Home</th>
                    <th>Away</th>
                    <th>Pick</th>
                    <th>Confidence</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="ats-content" class="content" style="display: none;">
        <h3 id="ats-title">Against the Spread</h3>
        <table id="ats-table">
            <thead>
                <tr>
                    <th>Away</th>
                    <th>Home</th>
                    <th>ATS Pick</th>
                    <th>Spread</th>
                    <th>Confidence</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="totals-content" class="content" style="display: none;">
        <h3 id="totals-title">Totals (Over/Under)</h3>
        <table id="totals-table">
            <thead>
                <tr>
                    <th>Away</th>
                    <th>Home</th>
                    <th>Total Pick</th>
                    <th>Line</th>
                    <th>Confidence</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="props-content" class="content" style="display: none;">
        <h3 id="props-title">Top Player Props (by Confidence)</h3>
        <table id="props-table">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Player</th>
                    <th>Market</th>
                    <th>Pick</th>
                    <th>Line</th>
                    <th>Confidence</th>
                    <th>Book</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="fantasy-content" class="content" style="display: none;">
        <h3>Fantasy Picks</h3>
        <table id="fantasy-table">
            <thead>
                <tr>
                    <th>Player</th>
                    <th>Position</th>
                    <th>Salary</th>
                    <th>Projected Points</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        let currentWeek = 1;
        let currentTab = 'su';

        function changeWeek() {
            currentWeek = document.getElementById('weekSelect').value;
            document.getElementById('week').textContent = currentWeek;
            fetchData();
        }

        function showTab(tab) {
            // Hide all content
            document.querySelectorAll('.content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));

            // Show selected content
            document.getElementById(tab + '-content').style.display = 'block';
            event.target.classList.add('active');
            currentTab = tab;
        }

        function fetchData() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';

            fetch(`http://localhost:8080/v1/best-picks/2025/${currentWeek}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Data received:', data);
                    window.currentData = data; // Store for downloads
                    populateData(data);
                    document.getElementById('loading').style.display = 'none';
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('error').textContent = 'Error: ' + error.message;
                    document.getElementById('error').style.display = 'block';
                    document.getElementById('loading').style.display = 'none';
                });
        }

        function getConfidenceColor(confidence) {
            if (confidence > 0.7) return '#22c55e'; // Green
            if (confidence > 0.6) return '#f59e0b'; // Orange
            return '#6b7280'; // Gray
        }

        function getTeamLogos(matchup) {
            // Extract team names from "AWAY @ HOME" format
            const teams = matchup.split(' @ ');
            const awayTeam = teams[0];
            const homeTeam = teams[1];
            
            return {
                away: `https://a.espncdn.com/i/teamlogos/nfl/500/${awayTeam}.png`,
                home: `https://a.espncdn.com/i/teamlogos/nfl/500/${homeTeam}.png`,
                awayTeam: awayTeam,
                homeTeam: homeTeam
            };
        }

        function populateData(data) {
            // Update titles with counts
            document.getElementById('su-title').textContent = `Straight-Up Picks (${data.total_games || 0} Games)`;
            document.getElementById('ats-title').textContent = `Against the Spread (${data.total_games || 0} Games)`;
            document.getElementById('totals-title').textContent = `Totals - Over/Under (${data.total_games || 0} Games)`;
            document.getElementById('props-title').textContent = `Top Player Props (${data.total_props || 0} by Confidence)`;
            
            // Show data source indicator
            const indicator = document.getElementById('dataSourceIndicator');
            if (data.data_source === 'live') {
                indicator.textContent = 'ðŸŸ¢ Live Data';
                indicator.className = 'data-source-indicator live-data';
            } else {
                indicator.textContent = 'ðŸŸ¡ Mock Data';
                indicator.className = 'data-source-indicator mock-data';
            }
            
            // Update timestamp info
            if (data.timestamp) {
                const timestamp = new Date(data.timestamp).toLocaleTimeString();
                indicator.title = `Last updated: ${timestamp}`;
            }
            
            // Populate SU table with logos
            const suTable = document.querySelector('#su-table tbody');
            suTable.innerHTML = '';
            (data.best_picks || []).forEach(pick => {
                const row = suTable.insertRow();
                const confidenceColor = getConfidenceColor(pick.su_confidence);
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <img src="${pick.logo_home}" alt="${pick.home}" style="width: 20px; height: 20px;" onerror="this.style.display='none'">
                            <strong>${pick.home}</strong>
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <img src="${pick.logo_away}" alt="${pick.away}" style="width: 20px; height: 20px;" onerror="this.style.display='none'">
                            ${pick.away}
                        </div>
                    </td>
                    <td style="font-weight: bold; color: ${confidenceColor};">${pick.su_pick}</td>
                    <td style="font-weight: bold; color: ${confidenceColor};">${(pick.su_confidence * 100).toFixed(1)}%</td>
                `;
            });

            // Populate ATS table with team logos
            const atsTable = document.querySelector('#ats-table tbody');
            atsTable.innerHTML = '';
            (data.ats_picks || []).forEach(pick => {
                const row = atsTable.insertRow();
                const confidenceColor = getConfidenceColor(pick.ats_confidence);
                const spreadColor = pick.spread > 0 ? '#ef4444' : '#22c55e';
                const logos = getTeamLogos(pick.matchup);
                
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <img src="${logos.away}" alt="${logos.awayTeam}" style="width: 20px; height: 20px;" onerror="this.style.display='none'">
                            ${logos.awayTeam}
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <img src="${logos.home}" alt="${logos.homeTeam}" style="width: 20px; height: 20px;" onerror="this.style.display='none'">
                            <strong>${logos.homeTeam}</strong>
                        </div>
                    </td>
                    <td style="font-weight: bold; color: ${confidenceColor};">${pick.ats_pick}</td>
                    <td style="color: ${spreadColor}; font-weight: bold;">${pick.spread > 0 ? '+' : ''}${pick.spread}</td>
                    <td style="font-weight: bold; color: ${confidenceColor};">${(pick.ats_confidence * 100).toFixed(1)}%</td>
                `;
            });

            // Populate Totals table with team logos
            const totalsTable = document.querySelector('#totals-table tbody');
            totalsTable.innerHTML = '';
            (data.totals_picks || []).forEach(pick => {
                const row = totalsTable.insertRow();
                const confidenceColor = getConfidenceColor(pick.tot_confidence);
                const pickColor = pick.tot_pick.includes('Over') ? '#ef4444' : '#3b82f6';
                const logos = getTeamLogos(pick.matchup);
                
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <img src="${logos.away}" alt="${logos.awayTeam}" style="width: 20px; height: 20px;" onerror="this.style.display='none'">
                            ${logos.awayTeam}
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <img src="${logos.home}" alt="${logos.homeTeam}" style="width: 20px; height: 20px;" onerror="this.style.display='none'">
                            <strong>${logos.homeTeam}</strong>
                        </div>
                    </td>
                    <td style="font-weight: bold; color: ${pickColor};">${pick.tot_pick}</td>
                    <td style="font-weight: bold;">${pick.total_line}</td>
                    <td style="font-weight: bold; color: ${confidenceColor};">${(pick.tot_confidence * 100).toFixed(1)}%</td>
                `;
            });

            // Populate Props table (top 10 with ranking)
            const propsTable = document.querySelector('#props-table tbody');
            propsTable.innerHTML = '';
            (data.prop_bets || []).slice(0, 10).forEach((prop, index) => {
                const row = propsTable.insertRow();
                const confidenceColor = getConfidenceColor(prop.confidence);
                const pickColor = prop.pick === 'Over' ? '#ef4444' : '#3b82f6';
                const isTopThree = index < 3;
                const bgColor = isTopThree ? '#f0fdf4' : 'transparent';
                const fireEmoji = isTopThree ? ' ðŸ”¥' : '';
                
                row.style.backgroundColor = bgColor;
                row.innerHTML = `
                    <td style="font-weight: bold;">#${index + 1}</td>
                    <td>
                        <div>
                            <strong>${prop.player}</strong>
                            <div style="font-size: 12px; color: #6b7280;">${prop.team}</div>
                        </div>
                    </td>
                    <td>${prop.prop_type}</td>
                    <td style="font-weight: bold; color: ${pickColor};">${prop.pick}</td>
                    <td><strong>${prop.line}</strong></td>
                    <td style="font-weight: bold; color: ${confidenceColor};">${(prop.confidence * 100).toFixed(1)}%${fireEmoji}</td>
                    <td>${prop.bookmaker}</td>
                `;
            });

            // Populate Fantasy table
            const fantasyTable = document.querySelector('#fantasy-table tbody');
            fantasyTable.innerHTML = '';
            (data.fantasy_picks || []).forEach(pick => {
                const row = fantasyTable.insertRow();
                row.innerHTML = `
                    <td>${pick.player}</td>
                    <td>${pick.position}</td>
                    <td>$${pick.salary.toLocaleString()}</td>
                    <td>${pick.projected_points}</td>
                    <td>${pick.value_score}</td>
                `;
            });
        }

        function downloadCSV() {
            if (!window.currentData) {
                alert('No data available to download');
                return;
            }
            
            let csvContent = '';
            const data = window.currentData;
            
            if (currentTab === 'su') {
                csvContent = 'Home,Away,Pick,Confidence\n';
                (data.best_picks || []).forEach(pick => {
                    csvContent += `${pick.home},${pick.away},${pick.su_pick},${(pick.su_confidence * 100).toFixed(1)}%\n`;
                });
            } else if (currentTab === 'ats') {
                csvContent = 'Away,Home,ATS Pick,Spread,Confidence\n';
                (data.ats_picks || []).forEach(pick => {
                    const logos = getTeamLogos(pick.matchup);
                    csvContent += `${logos.awayTeam},${logos.homeTeam},${pick.ats_pick},${pick.spread},${(pick.ats_confidence * 100).toFixed(1)}%\n`;
                });
            } else if (currentTab === 'totals') {
                csvContent = 'Away,Home,Total Pick,Line,Confidence\n';
                (data.totals_picks || []).forEach(pick => {
                    const logos = getTeamLogos(pick.matchup);
                    csvContent += `${logos.awayTeam},${logos.homeTeam},${pick.tot_pick},${pick.total_line},${(pick.tot_confidence * 100).toFixed(1)}%\n`;
                });
            } else if (currentTab === 'props') {
                csvContent = 'Rank,Player,Team,Market,Pick,Line,Confidence,Bookmaker\n';
                (data.prop_bets || []).slice(0, 10).forEach((prop, index) => {
                    csvContent += `${index + 1},${prop.player},${prop.team},${prop.prop_type},${prop.pick},${prop.line},${(prop.confidence * 100).toFixed(1)}%,${prop.bookmaker}\n`;
                });
            }
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nfl-week-${currentWeek}-${currentTab}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function downloadPDF() {
            if (!window.currentData) {
                alert('No data available to download');
                return;
            }
            
            window.print();
        }

        // Load data on page load
        fetchData();
    </script>
</body>

</html>